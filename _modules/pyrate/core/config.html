

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyrate.core.config &mdash; PyRate 0.4.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../../../index.html">
          

          
            
            <img src="../../../_static/PyRate_logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    <li><a href="https://geoscienceaustralia.github.io/PyRate/">Home</a></li>
    
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#ubuntu-18-04">Ubuntu 18.04</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#hpc">HPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#verify-installation">Verify Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage.html#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage.html#workflow">Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage.html#parallel-processing">Parallel processing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../troubleshooting.html#out-of-memory-errors">Out of memory errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../troubleshooting.html#incorrect-modules-loaded-on-raijin">Incorrect modules loaded on Raijin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#types-of-contributions">Types of Contributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#pull-request-guidelines">Pull Request Guidelines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Credits</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../authors.html#development-lead">Development Lead</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../authors.html#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../history.html">Release History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../history.html#id1">0.4.0 (2019-10-31)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../history.html#id2">0.3.0 (2019-07-26)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../history.html#id6">0.2.0 (2017-05-22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../history.html#id7">0.1.0 (2017-01-31)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../scripts.html">PyRate Scripts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../pyrate.conv2tif.html">PyRate Conv2tif Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pyrate.prepifg.html">PyRate Prepifg Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pyrate.process.html">PyRate Process Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pyrate.merge.html">PyRate Merge Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pyrate.__main__.html">PyRate Main Script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Pyrate Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../algorithm.html">Algorithm Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../aps.html">Atmospheric Phase Screen Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../config.html">Config Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../covariance.html">Covariance Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gamma.html">GAMMA Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../linrate.html">Linrate Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mst.html">Minimum Spanning Tree Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../orbital.html">Orbital Error Correction Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pyratelog.html">Logging Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ref_phs_est.html">Reference Phase Calculation Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../refpixel.html">Reference Pixel Calculation Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../roipac.html">ROI_PAC Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../shared.html">Shared Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../timeseries.html">Time Series Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gdal_python.html">GDAL-Python Bindings Module</a></li>
</ul>
</li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyRate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pyrate.core.config</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyrate.core.config</h1><div class="highlight"><pre>
<span></span><span class="c1">#   This Python module is part of the PyRate software package.</span>
<span class="c1">#</span>
<span class="c1">#   Copyright 2017 Geoscience Australia</span>
<span class="c1">#</span>
<span class="c1">#   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1">#   you may not use this file except in compliance with the License.</span>
<span class="c1">#   You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#       http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1">#   Unless required by applicable law or agreed to in writing, software</span>
<span class="c1">#   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1">#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1">#   See the License for the specific language governing permissions and</span>
<span class="c1">#   limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This Python module contains utilities to parse PyRate configuration</span>
<span class="sd">files. It also includes numerous general constants relating to options</span>
<span class="sd">in configuration files. Examples of PyRate configuration files are</span>
<span class="sd">provided in the configs/ directory</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># coding: utf-8</span>
<span class="c1"># pylint: disable=invalid-name</span>
<span class="c1"># pylint: disable=W1203</span>
<span class="c1"># pylint: disable=too-many-locals</span>
<span class="c1"># pylint: disable=trailing-whitespace</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">split</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">pyrate.core.ifgconstants</span> <span class="k">import</span> <span class="n">YEARS_PER_DAY</span>
<span class="kn">from</span> <span class="nn">pyrate</span> <span class="k">import</span> <span class="n">CONV2TIF</span><span class="p">,</span> <span class="n">PREPIFG</span><span class="p">,</span> <span class="n">PROCESS</span><span class="p">,</span> <span class="n">MERGE</span>

<span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># general constants</span>
<span class="n">NO_MULTILOOKING</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ROIPAC</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">GAMMA</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="s1">&#39;INFO&#39;</span>
<span class="n">SIXTEEN_DIGIT_EPOCH_PAIR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{8}</span><span class="s1">-\d</span><span class="si">{8}</span><span class="s1">&#39;</span>
<span class="n">TWELVE_DIGIT_EPOCH_PAIR</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{6}</span><span class="s1">-\d</span><span class="si">{6}</span><span class="s1">&#39;</span>
<span class="n">EIGHT_DIGIT_EPOCH</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{8}</span><span class="s1">&#39;</span>
<span class="n">MINIMUM_NUMBER_EPOCHS</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># constants for lookups</span>
<span class="c1">#: STR; Name of input interferogram list file</span>
<span class="n">IFG_FILE_LIST</span> <span class="o">=</span> <span class="s1">&#39;ifgfilelist&#39;</span>
<span class="c1">#: BOOL (0/1); The interferogram processor used (0==ROIPAC, 1==GAMMA)</span>
<span class="n">PROCESSOR</span> <span class="o">=</span> <span class="s1">&#39;processor&#39;</span>
<span class="c1">#: STR; Name of directory containing input interferograms.</span>
<span class="n">OBS_DIR</span> <span class="o">=</span> <span class="s1">&#39;obsdir&#39;</span>
<span class="c1">#: STR; Name of directory for saving output products</span>
<span class="n">OUT_DIR</span> <span class="o">=</span> <span class="s1">&#39;outdir&#39;</span>
<span class="c1">#: STR; Name of Digital Elevation Model file</span>
<span class="n">DEM_FILE</span> <span class="o">=</span> <span class="s1">&#39;demfile&#39;</span>
<span class="c1">#: STR; Name of the DEM header file</span>
<span class="n">DEM_HEADER_FILE</span> <span class="o">=</span> <span class="s1">&#39;demHeaderFile&#39;</span>
<span class="c1">#: STR; Name of directory containing GAMMA SLC header files</span>
<span class="n">SLC_DIR</span> <span class="o">=</span> <span class="s1">&#39;slcFileDir&#39;</span>
<span class="c1">#: STR; Name of the file list containing the pool of available SLC headers</span>
<span class="n">SLC_FILE_LIST</span> <span class="o">=</span> <span class="s1">&#39;slcfilelist&#39;</span>


<span class="c1"># STR; The projection of the input interferograms.</span>
<span class="c1"># TODO: only used in tests; deprecate?</span>
<span class="n">INPUT_IFG_PROJECTION</span> <span class="o">=</span> <span class="s1">&#39;projection&#39;</span>
<span class="c1">#: FLOAT; The no data value in the interferogram files.</span>
<span class="n">NO_DATA_VALUE</span> <span class="o">=</span> <span class="s1">&#39;noDataValue&#39;</span>
<span class="c1">#: FLOAT; No data averaging threshold for prepifg</span>
<span class="n">NO_DATA_AVERAGING_THRESHOLD</span> <span class="o">=</span> <span class="s1">&#39;noDataAveragingThreshold&#39;</span>
<span class="c1"># BOOL (1/2/3); Re-project data from Line of sight, 1 = vertical, 2 = horizontal, 3 = no conversion</span>
<span class="c1">#REPROJECTION = &#39;prjflag&#39; # NOT CURRENTLY USED</span>
<span class="c1">#: BOOL (0/1): Convert no data values to Nan</span>
<span class="n">NAN_CONVERSION</span> <span class="o">=</span> <span class="s1">&#39;nan_conversion&#39;</span>

<span class="c1"># Prepifg parameters</span>
<span class="c1">#: BOOL (1/2/3/4); Method for cropping interferograms, 1 = minimum overlapping area (intersection), 2 = maximum area (union), 3 = customised area, 4 = all ifgs already same size</span>
<span class="n">IFG_CROP_OPT</span> <span class="o">=</span> <span class="s1">&#39;ifgcropopt&#39;</span>
<span class="c1">#: INT; Multi look factor for interferogram preparation in x dimension</span>
<span class="n">IFG_LKSX</span> <span class="o">=</span> <span class="s1">&#39;ifglksx&#39;</span>
<span class="c1">#: INT; Multi look factor for interferogram preparation in y dimension</span>
<span class="n">IFG_LKSY</span> <span class="o">=</span> <span class="s1">&#39;ifglksy&#39;</span>
<span class="c1">#: FLOAT; Minimum longitude for cropping with method 3</span>
<span class="n">IFG_XFIRST</span> <span class="o">=</span> <span class="s1">&#39;ifgxfirst&#39;</span>
<span class="c1">#: FLOAT; Maximum longitude for cropping with method 3</span>
<span class="n">IFG_XLAST</span> <span class="o">=</span> <span class="s1">&#39;ifgxlast&#39;</span>
<span class="c1">#: FLOAT; Minimum latitude for cropping with method 3</span>
<span class="n">IFG_YFIRST</span> <span class="o">=</span> <span class="s1">&#39;ifgyfirst&#39;</span>
<span class="c1">#: FLOAT; Maximum latitude for cropping with method 3</span>
<span class="n">IFG_YLAST</span> <span class="o">=</span> <span class="s1">&#39;ifgylast&#39;</span>

<span class="c1"># reference pixel parameters</span>
<span class="c1">#: INT; Longitude (decimal degrees) of reference pixel, or if left blank a search will be performed</span>
<span class="n">REFX</span> <span class="o">=</span> <span class="s1">&#39;refx&#39;</span>
<span class="c1">#: INT; Latitude (decimal degrees) of reference pixel, or if left blank a search will be performed</span>
<span class="n">REFY</span> <span class="o">=</span> <span class="s1">&#39;refy&#39;</span>
<span class="c1">#: INT; Number of reference pixel grid search nodes in x dimension</span>
<span class="n">REFNX</span> <span class="o">=</span> <span class="s2">&quot;refnx&quot;</span>
<span class="c1">#: INT; Number of reference pixel grid search nodes in y dimension</span>
<span class="n">REFNY</span> <span class="o">=</span> <span class="s2">&quot;refny&quot;</span>
<span class="c1">#: INT; Dimension of reference pixel search window (in number of pixels)</span>
<span class="n">REF_CHIP_SIZE</span> <span class="o">=</span> <span class="s1">&#39;refchipsize&#39;</span>
<span class="c1">#: FLOAT; Minimum fraction of observations required in search window for pixel to be a viable reference pixel</span>
<span class="n">REF_MIN_FRAC</span> <span class="o">=</span> <span class="s1">&#39;refminfrac&#39;</span>
<span class="c1">#: BOOL (1/2); Reference phase estimation method (1: median of the whole interferogram, 2: median within the window surrounding the reference pixel)</span>
<span class="n">REF_EST_METHOD</span> <span class="o">=</span> <span class="s1">&#39;refest&#39;</span>

<span class="c1"># coherence masking parameters</span>
<span class="c1">#: BOOL (0/1); Perform coherence masking (1: yes, 0: no)</span>
<span class="n">COH_MASK</span> <span class="o">=</span> <span class="s1">&#39;cohmask&#39;</span>
<span class="c1">#: FLOAT; Coherence threshold for masking</span>
<span class="n">COH_THRESH</span> <span class="o">=</span> <span class="s1">&#39;cohthresh&#39;</span>
<span class="c1">#: STR; Directory containing coherence files; defaults to OBS_DIR if not provided</span>
<span class="n">COH_FILE_DIR</span> <span class="o">=</span> <span class="s1">&#39;cohfiledir&#39;</span>
<span class="c1">#: STR; Name of the file list containing the pool of available coherence files</span>
<span class="n">COH_FILE_LIST</span> <span class="o">=</span> <span class="s1">&#39;cohfilelist&#39;</span>

<span class="c1">#atmospheric error correction parameters NOT CURRENTLY USED</span>
<span class="n">APS_CORRECTION</span> <span class="o">=</span> <span class="s1">&#39;apscorrect&#39;</span>
<span class="n">APS_METHOD</span> <span class="o">=</span> <span class="s1">&#39;apsmethod&#39;</span>
<span class="n">APS_INCIDENCE_MAP</span> <span class="o">=</span> <span class="s1">&#39;incidencemap&#39;</span>
<span class="n">APS_INCIDENCE_EXT</span> <span class="o">=</span> <span class="s1">&#39;APS_INCIDENCE_EXT&#39;</span>
<span class="n">APS_ELEVATION_MAP</span> <span class="o">=</span> <span class="s1">&#39;elevationmap&#39;</span>
<span class="n">APS_ELEVATION_EXT</span> <span class="o">=</span> <span class="s1">&#39;APS_ELEVATION_EXT&#39;</span>

<span class="c1"># orbital error correction/parameters</span>
<span class="c1">#: BOOL (1/0); Perform orbital error correction (1: yes, 0: no)</span>
<span class="n">ORBITAL_FIT</span> <span class="o">=</span> <span class="s1">&#39;orbfit&#39;</span>
<span class="c1">#: BOOL (1/2); Method for orbital error correction (1: independent, 2: network)</span>
<span class="n">ORBITAL_FIT_METHOD</span> <span class="o">=</span> <span class="s1">&#39;orbfitmethod&#39;</span>
<span class="c1">#: BOOL (1/2/3) Polynomial order of orbital error model (1: planar in x and y - 2 parameter model, 2: quadratic in x and y - 5 parameter model, 3: quadratic in x and cubic in y - part-cubic 6 parameter model)</span>
<span class="n">ORBITAL_FIT_DEGREE</span> <span class="o">=</span> <span class="s1">&#39;orbfitdegrees&#39;</span>
<span class="c1">#: INT; Multi look factor for orbital error calculation in x dimension</span>
<span class="n">ORBITAL_FIT_LOOKS_X</span> <span class="o">=</span> <span class="s1">&#39;orbfitlksx&#39;</span>
<span class="c1">#: INT; Multi look factor for orbital error calculation in y dimension</span>
<span class="n">ORBITAL_FIT_LOOKS_Y</span> <span class="o">=</span> <span class="s1">&#39;orbfitlksy&#39;</span>

<span class="c1"># Stacking parameters</span>
<span class="c1">#: FLOAT; Threshold ratio between &#39;model minus observation&#39; residuals and a-priori observation standard deviations for stacking estimate acceptance (otherwise remove furthest outlier and re-iterate)</span>
<span class="n">LR_NSIG</span> <span class="o">=</span> <span class="s1">&#39;nsig&#39;</span>
<span class="c1">#: INT; Number of required observations per pixel for stacking to occur</span>
<span class="n">LR_PTHRESH</span> <span class="o">=</span> <span class="s1">&#39;pthr&#39;</span>
<span class="c1">#: FLOAT; Maximum allowable standard error for pixels in stacking</span>
<span class="n">LR_MAXSIG</span> <span class="o">=</span> <span class="s1">&#39;maxsig&#39;</span>

<span class="c1"># atmospheric delay errors fitting parameters NOT CURRENTLY USED</span>
<span class="c1"># atmfitmethod = 1: interferogram by interferogram; atmfitmethod = 2, epoch by epoch</span>
<span class="c1">#ATM_FIT = &#39;atmfit&#39;</span>
<span class="c1">#ATM_FIT_METHOD = &#39;atmfitmethod&#39;</span>

<span class="c1"># APS correction parameters</span>
<span class="c1">#: BOOL (0/1) Perform APS correction (1: yes, 0: no)</span>
<span class="n">APSEST</span> <span class="o">=</span> <span class="s1">&#39;apsest&#39;</span>
<span class="c1"># temporal low-pass filter parameters</span>
<span class="c1">#: INT (1/2/3); Method for temporal filtering (1: Gaussian, 2: Triangular, 3: Mean filter)</span>
<span class="n">TLPF_METHOD</span> <span class="o">=</span> <span class="s1">&#39;tlpfmethod&#39;</span>
<span class="c1">#: FLOAT; Cutoff time for gaussian filter in years;</span>
<span class="n">TLPF_CUTOFF</span> <span class="o">=</span> <span class="s1">&#39;tlpfcutoff&#39;</span>
<span class="c1">#: INT; Number of required input observations per pixel for temporal filtering</span>
<span class="n">TLPF_PTHR</span> <span class="o">=</span> <span class="s1">&#39;tlpfpthr&#39;</span>
<span class="c1"># spatially correlated noise low-pass filter parameters</span>
<span class="c1">#: INT (1/2); Method for spatial filtering(1: butterworth; 2: gaussian)</span>
<span class="n">SLPF_METHOD</span> <span class="o">=</span> <span class="s1">&#39;slpfmethod&#39;</span>
<span class="c1">#: FLOAT; Cutoff  value for both butterworth and gaussian filters in km</span>
<span class="n">SLPF_CUTOFF</span> <span class="o">=</span> <span class="s1">&#39;slpfcutoff&#39;</span>
<span class="c1">#: INT; Order of butterworth filter (default 1)</span>
<span class="n">SLPF_ORDER</span> <span class="o">=</span> <span class="s1">&#39;slpforder&#39;</span>
<span class="c1">#: INT (1/0); Do spatial interpolation at NaN locations (1 for interpolation, 0 for zero fill)</span>
<span class="n">SLPF_NANFILL</span> <span class="o">=</span> <span class="s1">&#39;slpnanfill&#39;</span>
<span class="c1">#: #: STR; Method for spatial interpolation (one of: linear, nearest, cubic), only used when slpnanfill=1</span>
<span class="n">SLPF_NANFILL_METHOD</span> <span class="o">=</span> <span class="s1">&#39;slpnanfill_method&#39;</span>

<span class="c1"># Time series parameters</span>
<span class="c1">#: BOOL (1/0); Perform time series calculation (1: yes, 0: no)</span>
<span class="n">TIME_SERIES_CAL</span> <span class="o">=</span> <span class="s1">&#39;tscal&#39;</span>
<span class="c1">#: INT (1/2); Method for time series inversion (1: Laplacian Smoothing; 2: SVD)</span>
<span class="n">TIME_SERIES_METHOD</span> <span class="o">=</span> <span class="s1">&#39;tsmethod&#39;</span>
<span class="c1">#: INT; Number of required input observations per pixel for time series inversion</span>
<span class="n">TIME_SERIES_PTHRESH</span> <span class="o">=</span> <span class="s1">&#39;ts_pthr&#39;</span>
<span class="c1">#: INT (1/2); Order of Laplacian smoothing operator, first or second order</span>
<span class="n">TIME_SERIES_SM_ORDER</span> <span class="o">=</span> <span class="s1">&#39;smorder&#39;</span>
<span class="c1">#: FLOAT; Laplacian smoothing factor (values used is 10**smfactor)</span>
<span class="n">TIME_SERIES_SM_FACTOR</span> <span class="o">=</span> <span class="s1">&#39;smfactor&#39;</span>
<span class="c1"># tsinterp is automatically assigned in the code; not needed in conf file</span>
<span class="c1">#TIME_SERIES_INTERP = &#39;tsinterp&#39;</span>

<span class="c1">#: BOOL (0/1/2); Use parallelisation/Multi-threading (0: in serial, 1: in parallel by rows, 2: in parallel by pixel)</span>
<span class="n">PARALLEL</span> <span class="o">=</span> <span class="s1">&#39;parallel&#39;</span>
<span class="c1">#: INT; Number of processes for multi-threading</span>
<span class="n">PROCESSES</span> <span class="o">=</span> <span class="s1">&#39;processes&#39;</span>

<span class="c1"># Orbital error correction constants for conversion to readable strings</span>
<span class="n">INDEPENDENT_METHOD</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">NETWORK_METHOD</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">PLANAR</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">QUADRATIC</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">PART_CUBIC</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Orbital error name look up for logging</span>
<span class="n">ORB_METHOD_NAMES</span> <span class="o">=</span> <span class="p">{</span><span class="n">INDEPENDENT_METHOD</span><span class="p">:</span> <span class="s1">&#39;INDEPENDENT&#39;</span><span class="p">,</span> 
                    <span class="n">NETWORK_METHOD</span><span class="p">:</span> <span class="s1">&#39;NETWORK&#39;</span><span class="p">}</span>
<span class="n">ORB_DEGREE_NAMES</span> <span class="o">=</span> <span class="p">{</span><span class="n">PLANAR</span><span class="p">:</span> <span class="s1">&#39;PLANAR&#39;</span><span class="p">,</span> 
                    <span class="n">QUADRATIC</span><span class="p">:</span> <span class="s1">&#39;QUADRATIC&#39;</span><span class="p">,</span> 
                    <span class="n">PART_CUBIC</span><span class="p">:</span> <span class="s1">&#39;PART CUBIC&#39;</span><span class="p">}</span>

<span class="c1"># dir for temp files</span>
<span class="n">TMPDIR</span> <span class="o">=</span> <span class="s1">&#39;tmpdir&#39;</span>

<span class="c1"># Lookup to help convert args to correct type/defaults</span>
<span class="c1"># format is	key : (conversion, default value)</span>
<span class="c1"># None = no conversion</span>
<span class="n">PARAM_CONVERSION</span> <span class="o">=</span> <span class="p">{</span>
<span class="c1">#    REPROJECTION : (int, 3), # Default no conversion, CONVERSION NOT IMPLEMENTED</span>
    <span class="n">IFG_CROP_OPT</span> <span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1"># default to area &#39;intersection&#39; option</span>
    <span class="n">IFG_LKSX</span> <span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">NO_MULTILOOKING</span><span class="p">),</span>
    <span class="n">IFG_LKSY</span> <span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">NO_MULTILOOKING</span><span class="p">),</span>
    <span class="n">IFG_XFIRST</span> <span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">IFG_XLAST</span> <span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">IFG_YFIRST</span> <span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">IFG_YLAST</span> <span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">NO_DATA_VALUE</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>

    <span class="n">COH_MASK</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">COH_THRESH</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>

    <span class="n">REFX</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">REFY</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">REFNX</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="n">REFNY</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="n">REF_CHIP_SIZE</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span>
    <span class="n">REF_MIN_FRAC</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="n">REF_EST_METHOD</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># default to average of whole image</span>

    <span class="n">ORBITAL_FIT</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">ORBITAL_FIT_METHOD</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">NETWORK_METHOD</span><span class="p">),</span>
    <span class="n">ORBITAL_FIT_DEGREE</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">PLANAR</span><span class="p">),</span>
    <span class="n">ORBITAL_FIT_LOOKS_X</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="n">ORBITAL_FIT_LOOKS_Y</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>

    <span class="n">LR_NSIG</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="c1"># pixel thresh based on nepochs? not every project may have 20 epochs</span>
    <span class="n">LR_PTHRESH</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="n">LR_MAXSIG</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>

    <span class="c1">#ATM_FIT: (int, 0), NOT CURRENTLY USED</span>
    <span class="c1">#ATM_FIT_METHOD: (int, 2),</span>

    <span class="n">APSEST</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">TLPF_METHOD</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">TLPF_CUTOFF</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="n">TLPF_PTHR</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

    <span class="n">SLPF_METHOD</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">SLPF_CUTOFF</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
    <span class="n">SLPF_ORDER</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">SLPF_NANFILL</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

    <span class="n">TIME_SERIES_CAL</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="c1"># pixel thresh based on nepochs? not every project may have 20 epochs</span>
    <span class="n">TIME_SERIES_PTHRESH</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="n">TIME_SERIES_SM_FACTOR</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="n">TIME_SERIES_SM_ORDER</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">TIME_SERIES_METHOD</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># Default to SVD method</span>

    <span class="n">PARALLEL</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">PROCESSES</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
    <span class="n">PROCESSOR</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">NAN_CONVERSION</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">NO_DATA_AVERAGING_THRESHOLD</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">}</span>

<span class="n">PATHS</span> <span class="o">=</span> <span class="p">[</span><span class="n">OBS_DIR</span><span class="p">,</span> <span class="n">IFG_FILE_LIST</span><span class="p">,</span> <span class="n">DEM_FILE</span><span class="p">,</span>
         <span class="n">DEM_HEADER_FILE</span><span class="p">,</span> <span class="n">OUT_DIR</span><span class="p">,</span>
         <span class="n">SLC_DIR</span><span class="p">,</span> <span class="n">SLC_FILE_LIST</span><span class="p">,</span> <span class="n">COH_FILE_DIR</span><span class="p">,</span> <span class="n">COH_FILE_LIST</span><span class="p">,</span>
         <span class="n">APS_INCIDENCE_MAP</span><span class="p">,</span>
         <span class="n">APS_ELEVATION_MAP</span><span class="p">]</span>

<span class="n">DEFAULT_TO_OBS_DIR</span> <span class="o">=</span> <span class="p">[</span><span class="n">SLC_DIR</span><span class="p">,</span> <span class="n">COH_FILE_DIR</span><span class="p">]</span>

<span class="n">INT_KEYS</span> <span class="o">=</span> <span class="p">[</span><span class="n">APS_CORRECTION</span><span class="p">,</span> <span class="n">APS_METHOD</span><span class="p">]</span>

<div class="viewcode-block" id="get_config_params"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.get_config_params">[docs]</a><span class="k">def</span> <span class="nf">get_config_params</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="n">CONV2TIF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads the parameters file provided by the user and converts it into</span>
<span class="sd">    a dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: Absolute path to the parameters file.</span>
<span class="sd">        validate: Validate the parameters if True, otherwise skip validation.</span>
<span class="sd">        step: The current step of the PyRate workflow.</span>

<span class="sd">    Returns:</span>
<span class="sd">       A dictionary of parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inputFile</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inputFile</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">line</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">PATHS</span><span class="p">):</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># create expanded line</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">line</span><span class="p">[(</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">):]</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="n">line</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">_parse_conf_file</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">validate</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">params</span><span class="p">[</span><span class="n">TMPDIR</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">OUT_DIR</span><span class="p">]),</span> <span class="s1">&#39;tmpdir&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">params</span></div>

<span class="k">def</span> <span class="nf">_parse_conf_file</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="n">CONV2TIF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts the parameters from their text form into a dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        content: Parameters as text.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary of parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_is_valid</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if line is not empty or has % or #</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">line</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s2">&quot;%#&quot;</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ln</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">_is_valid</span><span class="p">(</span><span class="n">ln</span><span class="p">)]</span>

    <span class="c1"># convert &quot;field:   value&quot; lines to [field, value]</span>
    <span class="n">kvpair</span> <span class="o">=</span> <span class="p">[(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kvpair</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">PATHS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">INT_KEYS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>  <span class="c1"># insert dummies</span>

    <span class="n">parameters</span> <span class="o">=</span> <span class="n">_handle_extra_parameters</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">parameters</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ConfigException</span><span class="p">(</span><span class="s1">&#39;Cannot parse any parameters from config file&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_parse_pars</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">validate</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_handle_extra_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to check if requirements for weather model correction are given.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span><span class="p">[</span><span class="n">APS_INCIDENCE_EXT</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">params</span><span class="p">[</span><span class="n">APS_ELEVATION_EXT</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">APS_INCIDENCE_MAP</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="n">APS_INCIDENCE_EXT</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">APS_INCIDENCE_MAP</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">params</span><span class="p">[</span><span class="n">APS_ELEVATION_MAP</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">params</span><span class="p">[</span><span class="n">APS_ELEVATION_EXT</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="c1"># define APS_ELEVATON_EXT for gamma prepifg</span>
    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">APS_ELEVATION_MAP</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="n">APS_ELEVATION_EXT</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
            <span class="n">params</span><span class="p">[</span><span class="n">APS_ELEVATION_MAP</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">params</span>

<span class="k">def</span> <span class="nf">_parse_pars</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="n">CONV2TIF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes dictionary of parameters, converting values to required type</span>
<span class="sd">    and providing defaults for missing values.</span>

<span class="sd">    Args:</span>
<span class="sd">        pars: Parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary of converted (and optionally validated) parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Fallback to default for missing values and perform conversion.</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">PARAM_CONVERSION</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pars</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">PARAM_CONVERSION</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;No value found for parameter &#39;</span><span class="si">{k}</span><span class="s2">&#39;. Using &quot;</span><span class="n">f</span><span class="s2">&quot;default value </span><span class="si">{pars[k]}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">conversion_func</span> <span class="o">=</span> <span class="n">PARAM_CONVERSION</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">conversion_func</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pars</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">conversion_func</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;Unable to convert &#39;</span><span class="si">{k}</span><span class="s2">&#39;: </span><span class="si">{pars[k]}</span><span class="s2"> to &quot;</span>
                                  <span class="n">f</span><span class="s2">&quot;expected type </span><span class="si">{conversion_func.__name__}</span><span class="s2">.&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">e</span>

    <span class="c1"># Fallback to default for missing paths.</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">DEFAULT_TO_OBS_DIR</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pars</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">OBS_DIR</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
        <span class="n">validate_parameters</span><span class="p">(</span><span class="n">pars</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pars</span>

<span class="c1"># CONFIG UTILS - TO BE MOVED?</span>
<div class="viewcode-block" id="parse_namelist"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.parse_namelist">[docs]</a><span class="k">def</span> <span class="nf">parse_namelist</span><span class="p">(</span><span class="n">nml</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses name list file into array of paths</span>

<span class="sd">    :param str nml: interferogram file list</span>

<span class="sd">    :return: list of interferogram file names</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">nml</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_in</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f_in</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span></div>

<div class="viewcode-block" id="write_config_file"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.write_config_file">[docs]</a><span class="k">def</span> <span class="nf">write_config_file</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">output_conf_file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes a param object and writes the config file. Reverse of get_conf_params.</span>

<span class="sd">    :param dict params: parameter dictionary</span>
<span class="sd">    :param str output_conf_file: output file name</span>

<span class="sd">    :return: config file</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_conf_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;:</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;:</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="transform_params"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.transform_params">[docs]</a><span class="k">def</span> <span class="nf">transform_params</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns subset of all parameters for cropping and multilooking.</span>

<span class="sd">    :param dict params: Parameter dictionary</span>

<span class="sd">    :return: xlooks, ylooks, crop</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">t_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">IFG_LKSX</span><span class="p">,</span> <span class="n">IFG_LKSY</span><span class="p">,</span> <span class="n">IFG_CROP_OPT</span><span class="p">]</span>
    <span class="n">xlooks</span><span class="p">,</span> <span class="n">ylooks</span><span class="p">,</span> <span class="n">crop</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t_params</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">xlooks</span><span class="p">,</span> <span class="n">ylooks</span><span class="p">,</span> <span class="n">crop</span></div>

<div class="viewcode-block" id="original_ifg_paths"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.original_ifg_paths">[docs]</a><span class="k">def</span> <span class="nf">original_ifg_paths</span><span class="p">(</span><span class="n">ifglist_path</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns sequence of paths to files in given ifglist file.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifglist_path: Absolute path to interferogram file list.</span>
<span class="sd">        obs_dir: Absolute path to observations directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of full paths to interferogram files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ifglist</span> <span class="o">=</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifglist_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obs_dir</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ifglist</span><span class="p">]</span></div>

<div class="viewcode-block" id="coherence_paths_for"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.coherence_paths_for">[docs]</a><span class="k">def</span> <span class="nf">coherence_paths_for</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">tif</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns path to coherence file for given interferogram. Pattern matches</span>
<span class="sd">    based on epoch in filename.</span>

<span class="sd">    Example:</span>
<span class="sd">        &#39;20151025-20160501_eqa_filt.cc&#39;</span>
<span class="sd">        Date pair is the epoch.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: Path to intergerogram to find coherence file for.</span>
<span class="sd">        params: Parameter dictionary.</span>
<span class="sd">        tif: Find converted tif if True (_cc.tif), else find .cc file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path to coherence file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{8}</span><span class="s1">-\d</span><span class="si">{8}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">coherence_dir</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">COH_FILE_DIR</span><span class="p">]</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">COH_FILE_LIST</span><span class="p">])</span>
               <span class="k">if</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">name</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">tif</span><span class="p">:</span>
        <span class="n">names_exts</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">ne</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ne</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span>
                   <span class="k">for</span> <span class="n">ne</span> <span class="ow">in</span> <span class="n">names_exts</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">coherence_dir</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span></div>

<div class="viewcode-block" id="coherence_paths"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.coherence_paths">[docs]</a><span class="k">def</span> <span class="nf">coherence_paths</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns paths to corresponding coherence files for given IFGs. Assumes</span>
<span class="sd">    that each IFG has a corresponding coherence file in the coherence file</span>
<span class="sd">    directory and they share epoch prefixes.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_paths: List of paths to intergerogram files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of full paths to coherence files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ifg_file_list</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IFG_FILE_LIST</span><span class="p">)</span>
    <span class="n">ifgs</span> <span class="o">=</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">coherence_paths_for</span><span class="p">(</span><span class="n">ifg</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="k">for</span> <span class="n">ifg</span> <span class="ow">in</span> <span class="n">ifgs</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">paths</span><span class="p">))</span></div>

<div class="viewcode-block" id="mlooked_path"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.mlooked_path">[docs]</a><span class="k">def</span> <span class="nf">mlooked_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">looks</span><span class="p">,</span> <span class="n">crop_out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds suffix to ifg path, for creating a new path for multilooked files.</span>

<span class="sd">    :param str path: original interferogram path</span>
<span class="sd">    :param int looks: number of range looks applied</span>
<span class="sd">    :param int crop_out: crop option applied</span>

<span class="sd">    :return: multilooked file name</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{base}</span><span class="s2">_</span><span class="si">{looks}</span><span class="s2">rlks_</span><span class="si">{crop_out}</span><span class="s2">cr</span><span class="si">{ext}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">looks</span><span class="o">=</span><span class="n">looks</span><span class="p">,</span> <span class="n">crop_out</span><span class="o">=</span><span class="n">crop_out</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_dest_paths"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.get_dest_paths">[docs]</a><span class="k">def</span> <span class="nf">get_dest_paths</span><span class="p">(</span><span class="n">base_paths</span><span class="p">,</span> <span class="n">crop</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">looks</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines the full path names for the destination multilooked files</span>

<span class="sd">    :param list base_paths: original interferogram paths</span>
<span class="sd">    :param int crop: Crop option applied</span>
<span class="sd">    :param dict params: Parameters dictionary</span>
<span class="sd">    :param int looks: number of range looks applied</span>

<span class="sd">    :return: full path names for destination files</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dest_mlooked_ifgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">mlooked_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                                      <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                      <span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="n">looks</span><span class="o">=</span><span class="n">looks</span><span class="p">,</span> <span class="n">crop_out</span><span class="o">=</span><span class="n">crop</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">base_paths</span><span class="p">]</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">OUT_DIR</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">dest_mlooked_ifgs</span><span class="p">]</span></div>

<div class="viewcode-block" id="get_ifg_paths"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.get_ifg_paths">[docs]</a><span class="k">def</span> <span class="nf">get_ifg_paths</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">CONV2TIF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the configuration file, extract interferogram file list and determine</span>
<span class="sd">    input and output interferogram path names.</span>

<span class="sd">    :param str config_file: Configuration file path</span>

<span class="sd">    :return: base_unw_paths: List of unwrapped inteferograms</span>
<span class="sd">    :return: dest_paths: List of multi-looked and cropped geotifs</span>
<span class="sd">    :return: params: Dictionary corresponding to the config file</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">get_config_params</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    <span class="n">ifg_file_list</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IFG_FILE_LIST</span><span class="p">)</span>

    <span class="n">xlks</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">crop</span> <span class="o">=</span> <span class="n">transform_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># base_unw_paths need to be geotiffed by conv2tif and multilooked by prepifg</span>
    <span class="n">base_unw_paths</span> <span class="o">=</span> <span class="n">original_ifg_paths</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">OBS_DIR</span><span class="p">])</span>

    <span class="c1"># dest_paths are tifs that have been coherence masked (if enabled),</span>
    <span class="c1">#  cropped and multilooked</span>

    <span class="k">if</span> <span class="s2">&quot;tif&quot;</span> <span class="ow">in</span> <span class="n">base_unw_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>

        <span class="n">dest_paths</span> <span class="o">=</span> <span class="n">get_dest_paths</span><span class="p">(</span><span class="n">base_unw_paths</span><span class="p">,</span> <span class="n">crop</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">xlks</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dest_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dest_paths</span><span class="p">):</span>
            <span class="n">dest_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dest_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_tif&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dest_paths</span> <span class="o">=</span> <span class="n">get_dest_paths</span><span class="p">(</span><span class="n">base_unw_paths</span><span class="p">,</span> <span class="n">crop</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">xlks</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">base_unw_paths</span><span class="p">,</span> <span class="n">dest_paths</span><span class="p">,</span> <span class="n">params</span></div>

<span class="c1"># ==== PARAMETER VALIDATION ==== #</span>

<span class="n">_PARAM_VALIDATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">OBS_DIR</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{OBS_DIR}</span><span class="s2">&#39;: directory must be provided and must exist.&quot;</span>
    <span class="p">),</span>
    <span class="n">IFG_FILE_LIST</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_FILE_LIST}</span><span class="s2">&#39;: file must be provided and must exist.&quot;</span>
    <span class="p">),</span>
    <span class="n">DEM_FILE</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{DEM_FILE}</span><span class="s2">&#39;: file must be provided and must exist.&quot;</span>
    <span class="p">),</span>
    <span class="n">DEM_HEADER_FILE</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{DEM_HEADER_FILE}</span><span class="s2">&#39;: file must be provided and must exist.&quot;</span>
    <span class="p">),</span>
    <span class="n">OUT_DIR</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{OBS_DIR}</span><span class="s2">&#39;: directory must be provided.&quot;</span>
    <span class="p">),</span>
    <span class="n">APS_INCIDENCE_MAP</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{APS_INCIDENCE_MAP}</span><span class="s2">&#39;: file must exist.&quot;</span>
    <span class="p">),</span>
    <span class="n">APS_ELEVATION_MAP</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{APS_ELEVATION_MAP}</span><span class="s2">&#39;: file must exists.&quot;</span>
    <span class="p">),</span>
    <span class="n">IFG_CROP_OPT</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_CROP_OPT}</span><span class="s2">&#39;: must select option 1, 2, 3, or 4.&quot;</span>
    <span class="p">),</span>
    <span class="n">IFG_LKSX</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_LKSX}</span><span class="s2">&#39;: must be &gt;= 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">IFG_LKSY</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_LKSY}</span><span class="s2">&#39;: must be &gt;= 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">NO_DATA_VALUE</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;Any float value valid.&quot;</span>
    <span class="p">),</span>
    <span class="n">COH_MASK</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{COH_MASK}</span><span class="s2">&#39;: must select option 0 or 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">REFX</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;Any float value valid.&quot;</span>
    <span class="p">),</span>
    <span class="n">REFY</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;Any float value valid.&quot;</span>
    <span class="p">),</span>
    <span class="n">ORBITAL_FIT</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{ORBITAL_FIT}</span><span class="s2">&#39;: must select option 0 or 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">LR_NSIG</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{LR_NSIG}</span><span class="s2">&#39;: must be between 1 and 10 (inclusive).&quot;</span>
    <span class="p">),</span>
    <span class="n">LR_PTHRESH</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{LR_PTHRESH}</span><span class="s2">&#39;: must be &gt;= 1&quot;</span>
    <span class="p">),</span>
    <span class="n">LR_MAXSIG</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{LR_MAXSIG}</span><span class="s2">&#39;: must be between 0 and 1000 (inclusive).&quot;</span>
    <span class="p">),</span>
    <span class="n">APSEST</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{APSEST}</span><span class="s2">&#39;: must select option 0 or 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">TIME_SERIES_CAL</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{TIME_SERIES_CAL}</span><span class="s2">&#39;: must select option 0 or 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">PARALLEL</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{PARALLEL}</span><span class="s2">&#39;: must select option 0 or 1 or 2.&quot;</span>
    <span class="p">),</span>
    <span class="n">PROCESSES</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{PROCESSES}</span><span class="s2">&#39;: must be &gt;= 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">PROCESSOR</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{PROCESSOR}</span><span class="s2">&#39;: must select option 0 or 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">NAN_CONVERSION</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{NAN_CONVERSION}</span><span class="s2">&#39;: must select option 0 or 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">NO_DATA_AVERAGING_THRESHOLD</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;Any float value valid.&quot;</span><span class="p">),</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;dict: basic validation functions for compulsory parameters.&quot;&quot;&quot;</span>

<span class="n">_CUSTOM_CROP_VALIDATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">IFG_XFIRST</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_XFIRST}</span><span class="s2">&#39;: must be provided.&quot;</span>
    <span class="p">),</span>
    <span class="n">IFG_XLAST</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_XLAST}</span><span class="s2">&#39;: must be provided.&quot;</span>
    <span class="p">),</span>
    <span class="n">IFG_YFIRST</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_YFIRST}</span><span class="s2">&#39;: must be provided.&quot;</span>
    <span class="p">),</span>
    <span class="n">IFG_YLAST</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_YLAST}</span><span class="s2">&#39;: must be provided..&quot;</span>
    <span class="p">),</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;dict: basic validation functions for custom cropping parameters.&quot;&quot;&quot;</span>

<span class="n">_GAMMA_VALIDATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">SLC_DIR</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{SLC_DIR}</span><span class="s2">&#39;: directory must must exist.&quot;</span>
    <span class="p">),</span>
    <span class="n">SLC_FILE_LIST</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{SLC_FILE_LIST}</span><span class="s2">&#39;: file must be provided and must exist.&quot;</span>
    <span class="p">),</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;dict: basic validation functions for gamma parameters.&quot;&quot;&quot;</span>

<span class="n">_COHERENCE_VALIDATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">COH_THRESH</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{COH_THRESH}</span><span class="s2">&#39;: must be between 0.0 and 1.0 (inclusive).&quot;</span>
    <span class="p">),</span>
    <span class="n">COH_FILE_DIR</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{COH_FILE_DIR}</span><span class="s2">&#39;: directory must exist.&quot;</span>
    <span class="p">),</span>
    <span class="n">COH_FILE_LIST</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{COH_FILE_LIST}</span><span class="s2">&#39;: file must be provided and must exist.&quot;</span>
    <span class="p">),</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;dict: basic validation functions for coherence parameters.&quot;&quot;&quot;</span>

<span class="n">_ORBITAL_FIT_VALIDATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">ORBITAL_FIT_METHOD</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{ORBITAL_FIT_METHOD}</span><span class="s2">&#39;: must select option 1 or 2.&quot;</span>
    <span class="p">),</span>
    <span class="n">ORBITAL_FIT_DEGREE</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{ORBITAL_FIT_DEGREE}</span><span class="s2">&#39;: must select option 1, 2 or 3.&quot;</span>
    <span class="p">),</span>
    <span class="n">ORBITAL_FIT_LOOKS_X</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{ORBITAL_FIT_LOOKS_X}</span><span class="s2">&#39;: must be &gt;= 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">ORBITAL_FIT_LOOKS_Y</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{ORBITAL_FIT_LOOKS_Y}</span><span class="s2">&#39;: must be &gt;= 1.&quot;</span>
    <span class="p">),</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;dict: basic validation fucntions for orbital error correction parameters.&quot;&quot;&quot;</span>

<span class="n">_APSEST_VALIDATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">TLPF_METHOD</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{TLPF_METHOD}</span><span class="s2">&#39;: must select option 1, 2 or 3.&quot;</span>
    <span class="p">),</span>
    <span class="n">TLPF_CUTOFF</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">YEARS_PER_DAY</span><span class="p">,</span> <span class="c1"># 1 day in years</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{TLPF_CUTOFF}</span><span class="s2">&#39;: must be &gt;= </span><span class="si">{YEARS_PER_DAY}</span><span class="s2">.&quot;</span>
    <span class="p">),</span>
    <span class="n">TLPF_PTHR</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{TLPF_PTHR}</span><span class="s2">&#39;: must be &gt;= 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">SLPF_METHOD</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{SLPF_METHOD}</span><span class="s2">&#39;: must select option 1 or 2.&quot;</span>
    <span class="p">),</span>
    <span class="n">SLPF_CUTOFF</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mf">0.001</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{SLPF_CUTOFF}</span><span class="s2">&#39;: must be &gt;= 0.001.&quot;</span>
    <span class="p">),</span>
    <span class="n">SLPF_ORDER</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{SLPF_ORDER}</span><span class="s2">&#39;: must be between 1 and 3 (inclusive).&quot;</span>
    <span class="p">),</span>
    <span class="n">SLPF_NANFILL</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{SLPF_NANFILL}</span><span class="s2">&#39;: must select option 0 or 1.&quot;</span>
    <span class="p">),</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;dict: basic validation functions for atmospheric correction parameters.&quot;&quot;&quot;</span>

<span class="n">_TIME_SERIES_VALIDATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">TIME_SERIES_PTHRESH</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{TIME_SERIES_PTHRESH}</span><span class="s2">&#39;: must be &gt;= 1.&quot;</span>
    <span class="p">),</span>
    <span class="n">TIME_SERIES_SM_FACTOR</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.0</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{TIME_SERIES_SM_FACTOR}</span><span class="s2">&#39;: must be between -5.0 and 0.&quot;</span>
    <span class="p">),</span>
    <span class="n">TIME_SERIES_SM_ORDER</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{TIME_SERIES_SM_ORDER}</span><span class="s2">&#39;: must select option 1 or 2.&quot;</span>
    <span class="p">),</span>
    <span class="n">TIME_SERIES_METHOD</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{TIME_SERIES_METHOD}</span><span class="s2">&#39;: must select option 1 or 2.&quot;</span>
    <span class="p">),</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;dict: basic vaidation functions for time series parameters.&quot;&quot;&quot;</span>

<span class="n">_REFERENCE_PIXEL_VALIDATION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">REFNX</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{REFNX}</span><span class="s2">&#39;: must be between 1 and 50 (inclusive).&quot;</span>
    <span class="p">),</span>
    <span class="n">REFNY</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{REFNY}</span><span class="s2">&#39;: must be between 1 and 50 (inclusive).&quot;</span>
    <span class="p">),</span>
    <span class="n">REF_CHIP_SIZE</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">101</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{REF_CHIP_SIZE}</span><span class="s2">&#39;: must be between 1 and 101 (inclusive) and be odd.&quot;</span>
    <span class="p">),</span>
    <span class="n">REF_MIN_FRAC</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{REF_MIN_FRAC}</span><span class="s2">&#39;: must be between 0.0 and 1.0 &quot;</span>
        <span class="s2">&quot;(inclusive).&quot;</span>
    <span class="p">),</span>
    <span class="n">REF_EST_METHOD</span><span class="p">:</span> <span class="p">(</span>
        <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{REF_EST_METHOD}</span><span class="s2">&#39;: must select option 1 or 2.&quot;</span>
    <span class="p">),</span>
<span class="p">}</span>
<span class="sd">&quot;&quot;&quot;dict: basic validation functions for reference pixel search parameters.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="convert_geographic_coordinate_to_pixel_value"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.convert_geographic_coordinate_to_pixel_value">[docs]</a><span class="k">def</span> <span class="nf">convert_geographic_coordinate_to_pixel_value</span><span class="p">(</span><span class="n">refpx</span><span class="p">,</span> <span class="n">refpy</span><span class="p">,</span> <span class="n">transform</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a lat/long coordinate to a pixel coordinate given the </span>
<span class="sd">    geotransform of the image.</span>

<span class="sd">    Args:</span>
<span class="sd">        refpx: The longitude of the coordinate.</span>
<span class="sd">        refpx: The latitude of the coordinate.</span>
<span class="sd">        transform: The geotransform array of the image.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of refpx, refpy in pixel values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># transform = ifg.dataset.GetGeoTransform()</span>

    <span class="n">xOrigin</span> <span class="o">=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yOrigin</span> <span class="o">=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">pixelWidth</span> <span class="o">=</span> <span class="n">transform</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pixelHeight</span> <span class="o">=</span> <span class="o">-</span><span class="n">transform</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

    <span class="n">refpx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">refpx</span> <span class="o">-</span> <span class="n">xOrigin</span><span class="p">)</span> <span class="o">/</span> <span class="n">pixelWidth</span><span class="p">)</span>
    <span class="n">refpy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">yOrigin</span> <span class="o">-</span> <span class="n">refpy</span><span class="p">)</span> <span class="o">/</span> <span class="n">pixelHeight</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">refpx</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">refpy</span><span class="p">)</span></div>

<span class="kn">from</span> <span class="nn">osgeo</span> <span class="k">import</span> <span class="n">gdal</span>
<div class="viewcode-block" id="validate_parameters"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_parameters">[docs]</a><span class="k">def</span> <span class="nf">validate_parameters</span><span class="p">(</span><span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="n">CONV2TIF</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main validation function. Calls validation subfunctions and gathers</span>
<span class="sd">    some required variables for performing validation.</span>

<span class="sd">    Args:</span>
<span class="sd">        pars: The parameters dictionary.</span>
<span class="sd">        step: The current step of the PyRate workflow. Determines what </span>
<span class="sd">            parameters to validate and what resources are available in</span>
<span class="sd">            terms of geotiffs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If errors occur during parameter validation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_GAMMA</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">PROCESSOR</span><span class="p">]</span> <span class="o">==</span> <span class="n">GAMMA</span>
    <span class="n">ifl</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">IFG_FILE_LIST</span><span class="p">]</span>

    <span class="c1"># TODO: Call bounds checking functions based on the current step</span>
    <span class="c1"># Call basic bounds checking functions for all parameters.</span>
    <span class="n">validate_compulsory_parameters</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
    <span class="n">validate_optional_parameters</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
    
    <span class="c1"># Validate that provided filenames contain correct epochs and that</span>
    <span class="c1">#  the files exist.</span>
    <span class="k">if</span> <span class="n">is_GAMMA</span><span class="p">:</span>
        <span class="n">validate_epochs</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">SIXTEEN_DIGIT_EPOCH_PAIR</span><span class="p">)</span>
        <span class="n">validate_epochs</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">SLC_FILE_LIST</span><span class="p">],</span> <span class="n">EIGHT_DIGIT_EPOCH</span><span class="p">)</span>
        <span class="n">validate_gamma_headers</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">SLC_FILE_LIST</span><span class="p">],</span> <span class="n">pars</span><span class="p">[</span><span class="n">SLC_DIR</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">validate_epochs</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">TWELVE_DIGIT_EPOCH_PAIR</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="n">CONV2TIF</span><span class="p">:</span>   
        <span class="c1"># Check that unwrapped interferograms exist.</span>
        <span class="n">validate_ifgs</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">OBS_DIR</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="n">PREPIFG</span><span class="p">:</span> 
        <span class="c1"># Check full res geotiffs exist before continuing.</span>
        <span class="n">validate_tifs_exist</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">OBS_DIR</span><span class="p">])</span>

        <span class="c1"># Check the minimum number of epochs.</span>
        <span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">list_of_epoches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>

                <span class="n">PTN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{8}</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># match 8 digits for the dates</span>

                <span class="c1"># if ROI_PAC</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;processor&quot;</span><span class="p">]:</span>
                    <span class="n">PTN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d</span><span class="si">{6}</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># match 8 digits for the dates</span>

                <span class="n">epochs</span> <span class="o">=</span> <span class="n">PTN</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">list_of_epoches</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>

        <span class="n">list_of_epoches</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">list_of_epoches</span><span class="p">)</span>
        <span class="n">n_epochs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_epoches</span><span class="p">)</span>
        <span class="n">validate_minimum_epochs</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">MINIMUM_NUMBER_EPOCHS</span><span class="p">)</span>

        <span class="c1"># validate</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># validate params for each geotiff</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>

                <span class="k">if</span> <span class="s2">&quot;.tif&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">tif_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;obsdir&quot;</span><span class="p">],</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                    <span class="n">tif_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;obsdir&quot;</span><span class="p">],</span> <span class="n">base</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">ext</span><span class="o">+</span><span class="s2">&quot;.tif&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">tif_file_path</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;GeoTiff: &quot;</span> <span class="o">+</span> <span class="n">tif_file_path</span> <span class="o">+</span> <span class="s2">&quot; not found.&quot;</span><span class="p">)</span>

                <span class="n">raster</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tif_file_path</span><span class="p">)</span>
                <span class="n">gtif</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>

                <span class="n">latitudes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">longitudes</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="n">gtif</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="s2">&quot;Size is&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">x_size</span><span class="p">,</span> <span class="n">y_size</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Size is&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="n">x_size</span><span class="p">,</span> <span class="n">y_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_size</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span><span class="nb">int</span><span class="p">(</span><span class="n">y_size</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                    <span class="k">for</span> <span class="n">line_tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Upper Left&quot;</span><span class="p">,</span> <span class="s2">&quot;Lower Left&quot;</span><span class="p">,</span> <span class="s2">&quot;Upper Right&quot;</span><span class="p">,</span> <span class="s2">&quot;Lower Right&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">line_tag</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                            <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="n">latitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">latitude</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
                            <span class="n">longitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">longitude</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

                <span class="c1"># validate multi-look parameters</span>
                <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifglksx&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifglksx&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x_size</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Value of ifglksx: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifglksx&quot;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; out of bounds: [0,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x_size</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifglksy&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifglksy&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">x_size</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Value of ifglksy: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifglksy&quot;</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; out of bounds: [0,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x_size</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>

                <span class="c1"># validate crop parameters</span>
                <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgxfirst&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">latitudes</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgxfirst&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">latitudes</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ifgxfirst: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgxfirst&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; not with in range {&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">latitudes</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">latitudes</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgxlast&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">latitudes</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgxlast&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">latitudes</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ifgxlast: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgxlast&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; not with in range {&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">latitudes</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">latitudes</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgyfirst&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">longitudes</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgyfirst&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">longitudes</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ifgyfirst: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgyfirst&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; not with in range {&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">longitudes</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">longitudes</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgylast&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">longitudes</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgylast&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">longitudes</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ifgylast: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;ifgylast&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; not with in range {&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">longitudes</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">longitudes</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>

                <span class="k">del</span> <span class="n">gtif</span>  <span class="c1"># manually close raster</span>

        <span class="c1"># Check coherence masking if enabled</span>
        <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="n">COH_MASK</span><span class="p">]:</span>
            <span class="n">validate_epochs</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">COH_FILE_LIST</span><span class="p">],</span> <span class="n">SIXTEEN_DIGIT_EPOCH_PAIR</span><span class="p">)</span>
            <span class="n">validate_coherence_files</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="n">PROCESS</span><span class="p">:</span>
        <span class="c1"># Check that cropped/subsampled tifs exist.</span>
        <span class="n">validate_prepifg_tifs_exist</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">OBS_DIR</span><span class="p">],</span> <span class="n">pars</span><span class="p">)</span>

        <span class="c1"># Check the minimum number of epochs.</span>
        <span class="n">n_epochs</span><span class="p">,</span> <span class="n">max_span</span> <span class="o">=</span> <span class="n">_get_temporal_info</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">OBS_DIR</span><span class="p">])</span>
        <span class="n">validate_minimum_epochs</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">MINIMUM_NUMBER_EPOCHS</span><span class="p">)</span>
        
        <span class="c1"># Get spatial information from tifs.</span>

        <span class="n">extents</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">_get_prepifg_info</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">OBS_DIR</span><span class="p">],</span> <span class="n">pars</span><span class="p">)</span>

        <span class="c1"># test if refx/y already set to default value of -1</span>
        <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>

            <span class="c1"># Convert refx/refy from lat/long to pixel and validate...</span>
            <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">180</span> <span class="ow">and</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">and</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">and</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>

                <span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">],</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_geographic_coordinate_to_pixel_value</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">],</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">],</span> <span class="n">transform</span><span class="p">)</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;converted pars[REFX], pars[REFY] to: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">]))</span>

                <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">n_cols</span><span class="p">:</span>
                    <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;converted pars[REFX] out of range&quot;</span><span class="p">)</span>
                    <span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">n_rows</span><span class="p">:</span>
                    <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;converted pars[REFY] out of range&quot;</span><span class="p">)</span>
                    <span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="c1"># otherwise we need to search for the pixel so validate the search parameters.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;given pars[REFX] or pars[REFY] out of range&quot;</span><span class="p">)</span>
                <span class="n">pars</span><span class="p">[</span><span class="n">REFX</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">pars</span><span class="p">[</span><span class="n">REFY</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="c1"># TODO fix tests when below validation is included</span>
                <span class="c1"># validate_reference_pixel_search_windows(n_cols, n_rows, pars)</span>

        <span class="n">validate_multilook_parameters</span><span class="p">(</span><span class="n">n_cols</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">,</span> 
                                      <span class="n">ORBITAL_FIT_LOOKS_X</span><span class="p">,</span> <span class="n">ORBITAL_FIT_LOOKS_Y</span><span class="p">,</span> 
                                      <span class="n">pars</span><span class="p">)</span>
        <span class="n">validate_slpf_cutoff</span><span class="p">(</span><span class="n">extents</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>
        <span class="n">validate_epoch_thresholds</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>
        <span class="n">validate_epoch_cutoff</span><span class="p">(</span><span class="n">max_span</span><span class="p">,</span> <span class="n">TLPF_CUTOFF</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>
        <span class="n">validate_obs_thresholds</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="n">MERGE</span><span class="p">:</span>
        <span class="n">validate_prepifg_tifs_exist</span><span class="p">(</span><span class="n">ifl</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">OBS_DIR</span><span class="p">],</span> <span class="n">pars</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience function for raising an exception with errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;invalid parameters&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ConfigException</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="validate_compulsory_parameters"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_compulsory_parameters">[docs]</a><span class="k">def</span> <span class="nf">validate_compulsory_parameters</span><span class="p">(</span><span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the validators for compulsory (always used) parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        pars: The parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if validation is successful.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="n">_PARAM_VALIDATION</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">validator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;No validator implemented for &#39;</span><span class="si">{k}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validator</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">pars</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">validator</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_optional_parameters"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_optional_parameters">[docs]</a><span class="k">def</span> <span class="nf">validate_optional_parameters</span><span class="p">(</span><span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the validators for optional parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        pars: The parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if validation successful.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">on</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">validators</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience method for calling validators.</span>

<span class="sd">        Args:</span>
<span class="sd">            on: Determines whether to call the validators.</span>
<span class="sd">            validators: A dictionary of validator functions.</span>
<span class="sd">            pars: Parameters dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">on</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">validator</span> <span class="ow">in</span> <span class="n">validators</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">validator</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">pars</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">validator</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">errors</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">COH_MASK</span><span class="p">],</span> <span class="n">_COHERENCE_VALIDATION</span><span class="p">,</span> <span class="n">pars</span><span class="p">))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">APSEST</span><span class="p">],</span> <span class="n">_APSEST_VALIDATION</span><span class="p">,</span> <span class="n">pars</span><span class="p">))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">TIME_SERIES_CAL</span><span class="p">],</span> <span class="n">_TIME_SERIES_VALIDATION</span><span class="p">,</span> <span class="n">pars</span><span class="p">))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">ORBITAL_FIT</span><span class="p">],</span> <span class="n">_ORBITAL_FIT_VALIDATION</span><span class="p">,</span> <span class="n">pars</span><span class="p">))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">PROCESSOR</span><span class="p">]</span> <span class="o">==</span> <span class="n">GAMMA</span><span class="p">,</span> <span class="n">_GAMMA_VALIDATION</span><span class="p">,</span> <span class="n">pars</span><span class="p">))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="n">IFG_CROP_OPT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="n">_CUSTOM_CROP_VALIDATION</span><span class="p">,</span> <span class="n">pars</span><span class="p">))</span>
    <span class="c1"># errors.extend(validate(pars[REFX] &gt; 0 and pars[REFY] &gt; 0, _REFERENCE_PIXEL_VALIDATION, pars))</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_minimum_epochs"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_minimum_epochs">[docs]</a><span class="k">def</span> <span class="nf">validate_minimum_epochs</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">min_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates the minimum number of epochs required for PyRate to produce</span>
<span class="sd">    good results.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_epochs: The number of unique epochs in the collection of interferograms</span>
<span class="sd">            provided as input.</span>
<span class="sd">        min_epochs: The minimum number of epochs PyRate requires.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if there are enough epochs to satisfy minimum epochs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If there are not enough epochs to satisfy min epochs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">n_epochs</span> <span class="o">&lt;</span> <span class="n">min_epochs</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_FILE_LIST}</span><span class="s2">&#39;: total number of epochs given is </span><span class="si">{n_epochs}</span><span class="s2">.&quot;</span>
                      <span class="n">f</span><span class="s2">&quot; </span><span class="si">{min_epochs}</span><span class="s2"> or more unique epochs are required by PyRate.&quot;</span><span class="p">)</span>
    <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_epochs"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_epochs">[docs]</a><span class="k">def</span> <span class="nf">validate_epochs</span><span class="p">(</span><span class="n">file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that user provided file names contain the correct pattern of</span>
<span class="sd">    epochs.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_list: Path to the list of files to validate.</span>
<span class="sd">        pattern: Regex string for finding the epoch(s).</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if all names in file list contain the epoch pattern *once*.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If not all names in the file list don&#39;t contain</span>
<span class="sd">            the epoch pattern or contain it more than once.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">PTN</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="n">PTN</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">epochs</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{file_list}</span><span class="s2">&#39;: </span><span class="si">{fn}</span><span class="s2"> does not contain an epoch of &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;format </span><span class="si">{pattern}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{file_list}</span><span class="s2">&#39;: </span><span class="si">{fn}</span><span class="s2"> does contains more than &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;one epoch of </span><span class="si">{pattern}</span><span class="s2">. There must be only one &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;epoch in the filename.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_epoch_cutoff"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_epoch_cutoff">[docs]</a><span class="k">def</span> <span class="nf">validate_epoch_cutoff</span><span class="p">(</span><span class="n">max_span</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate cutoff parameters that rely on the data timespan.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_span: The maximum temporal span of the provided data in years.</span>
<span class="sd">        cutoff: The key of the cutoff parameter.</span>
<span class="sd">        pars: The parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the cutoff is less than the maximum data timespan.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If the cutoff is greater than the max data timespan.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="n">cutoff</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_span</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{cutoff}</span><span class="s2">&#39;: must be less than max time span of &quot;</span>
                      <span class="s2">&quot;data in years (</span><span class="si">{max_span}</span><span class="s2">).&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_prepifg_tifs_exist"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_prepifg_tifs_exist">[docs]</a><span class="k">def</span> <span class="nf">validate_prepifg_tifs_exist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates that cropped and multilooked interferograms exist in geotiff</span>
<span class="sd">    format.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_file_list: Path to file containing interfergram file names.</span>
<span class="sd">        obs_dir: Path to observations directory.</span>
<span class="sd">        pars: Parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if all interferograms exist in geotiff format.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If not all intergerograms exist in geotiff format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">base_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obs_dir</span><span class="p">,</span> <span class="n">ifg</span><span class="p">)</span> <span class="k">for</span> <span class="n">ifg</span> <span class="ow">in</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">)]</span>
    <span class="n">ifg_paths</span> <span class="o">=</span> <span class="n">get_dest_paths</span><span class="p">(</span><span class="n">base_paths</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">IFG_CROP_OPT</span><span class="p">],</span> <span class="n">pars</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">IFG_LKSX</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ifg_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ifg_paths</span><span class="p">):</span>
        <span class="n">ifg_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifg_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_tif&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">ifg_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_FILE_LIST}</span><span class="s2">&#39;: interferogram &#39;</span><span class="si">{fname}</span><span class="s2">&#39; is &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;required as a cropped and subsampled geotiff but &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;could not be found. Make sure &#39;prepifg&#39; has been &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;run and ensure the &#39;</span><span class="si">{IFG_LKSX}</span><span class="s2">&#39; and &#39;</span><span class="si">{IFG_CROP_OPT}</span><span class="s2">&#39; &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;parameters have not been changed since &#39;prepifg&#39; was run.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_tifs_exist"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_tifs_exist">[docs]</a><span class="k">def</span> <span class="nf">validate_tifs_exist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates that provided interferograms exist in geotiff format.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_file_list: Path to file containing interfergram file names.</span>
<span class="sd">        obs_dir: Path to observations directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if all interferograms exist in geotiff format.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If not all intergerograms exist in geotiff format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyrate.core.shared</span> <span class="k">import</span> <span class="n">output_tiff_filename</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ifgs</span> <span class="o">=</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">)</span>
    <span class="n">ifg_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obs_dir</span><span class="p">,</span> <span class="n">ifg</span><span class="p">)</span> <span class="k">for</span> <span class="n">ifg</span> <span class="ow">in</span> <span class="n">ifgs</span><span class="p">]</span>
    <span class="n">gtiff_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">output_tiff_filename</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ifg_paths</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">gtp</span> <span class="ow">in</span> <span class="n">gtiff_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">gtp</span><span class="p">):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">gtp</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_FILE_LIST}</span><span class="s2">&#39;: interferogram &#39;</span><span class="si">{fname}</span><span class="s2">&#39; is &quot;</span>
                          <span class="s2">&quot;required in geotiff format but no geotiff file &quot;</span>
                          <span class="s2">&quot;could be found.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_ifgs"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_ifgs">[docs]</a><span class="k">def</span> <span class="nf">validate_ifgs</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates that provided interferograms exist.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_file_list: Path to file containing interferogram file names.</span>
<span class="sd">        obs_dir: Path to observations directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if all interferograms exist.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If not all interferograms exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ifgs</span> <span class="o">=</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">)</span>
    <span class="n">ifg_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obs_dir</span><span class="p">,</span> <span class="n">ifg</span><span class="p">)</span> <span class="k">for</span> <span class="n">ifg</span> <span class="ow">in</span> <span class="n">ifgs</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">ifg_paths</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{IFG_FILE_LIST}</span><span class="s2">&#39;: interferogram &#39;</span><span class="si">{fname}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_obs_thresholds"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_obs_thresholds">[docs]</a><span class="k">def</span> <span class="nf">validate_obs_thresholds</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates parameters that specify an observations threshold.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_file_list: Path to the file containing interferogram file names.</span>
<span class="sd">        pars: Parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if there are enough interferograms to satisfy all observation thresholds.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If there not enough interferograms to satisfy all observation</span>
<span class="sd">            thresholds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">thresh</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">thresh</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{k}</span><span class="s2">&#39;: not enough interferograms have been specified &quot;</span>
                    <span class="n">f</span><span class="s2">&quot;(</span><span class="si">{n}</span><span class="s2">) to satisfy threshold (</span><span class="si">{thresh}</span><span class="s2">).&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_ifgs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">)))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">n_ifgs</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">TIME_SERIES_PTHRESH</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="n">APSEST</span><span class="p">]:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">validate</span><span class="p">(</span><span class="n">n_ifgs</span><span class="p">,</span> <span class="n">pars</span><span class="p">,</span> <span class="n">TLPF_PTHR</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_epoch_thresholds"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_epoch_thresholds">[docs]</a><span class="k">def</span> <span class="nf">validate_epoch_thresholds</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates threshold paramters that rely on the number of epochs</span>
<span class="sd">    available.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_epochs: The number of unique epochs in the collection of interferograms</span>
<span class="sd">            provided as input.</span>
<span class="sd">        pars: Parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if there are enough epochs to satisfy all epoch thresholds.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If there are not enough epochs to satisfy all epoch thresholds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">LR_PTHRESH</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n_epochs</span> <span class="o">&lt;</span> <span class="n">thresh</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{LR_PTHRESH}</span><span class="s2">&#39;: not enough epochs have been specified &quot;</span>
                      <span class="n">f</span><span class="s2">&quot;(</span><span class="si">{n_epochs}</span><span class="s2">) to satisfy threshold (</span><span class="si">{thresh}</span><span class="s2">).&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_crop_parameters"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_crop_parameters">[docs]</a><span class="k">def</span> <span class="nf">validate_crop_parameters</span><span class="p">(</span><span class="n">min_extents</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                             <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates IFG crop parameters by ensuring user provided crop coordinates</span>
<span class="sd">    are within the *minimum* (intersecting) bounds of the interferogram stack.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        min_extents: The minimum extents of the interferogram stack. The</span>
<span class="sd">            crop coordinates must be within these extents.</span>
<span class="sd">        pars: Parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if validation is successful.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">min_xmin</span><span class="p">,</span> <span class="n">min_ymin</span><span class="p">,</span> <span class="n">min_xmax</span><span class="p">,</span> <span class="n">min_ymax</span> <span class="o">=</span> <span class="n">min_extents</span>
    <span class="n">x_dim_string</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;(xmin: </span><span class="si">{min_xmin}</span><span class="s2">, xmax: </span><span class="si">{min_xmax}</span><span class="s2">)&quot;</span>
    <span class="n">y_dim_string</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;(ymin: </span><span class="si">{min_ymin}</span><span class="s2">, ymax: </span><span class="si">{min_ymax}</span><span class="s2">)&quot;</span>

    <span class="c1"># Check crop coordinates within scene.</span>
    <span class="k">def</span> <span class="nf">_validate_crop_coord</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">dim_min</span><span class="p">,</span> <span class="n">dim_max</span><span class="p">,</span> <span class="n">dim_string</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dim_min</span> <span class="o">&lt;</span> <span class="n">pars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dim_max</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{var_name}</span><span class="s2">&#39;: crop coordinate (</span><span class="si">{pars[var_name]}</span><span class="s2">) &quot;</span>
                    <span class="n">f</span><span class="s2">&quot;is outside bounds of scene </span><span class="si">{dim_string}</span><span class="s2">.&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_validate_crop_coord</span><span class="p">(</span><span class="n">IFG_XFIRST</span><span class="p">,</span> <span class="n">min_xmin</span><span class="p">,</span> <span class="n">min_xmax</span><span class="p">,</span> <span class="n">x_dim_string</span><span class="p">))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_validate_crop_coord</span><span class="p">(</span><span class="n">IFG_YFIRST</span><span class="p">,</span> <span class="n">min_ymin</span><span class="p">,</span> <span class="n">min_ymax</span><span class="p">,</span> <span class="n">y_dim_string</span><span class="p">))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_validate_crop_coord</span><span class="p">(</span><span class="n">IFG_XLAST</span><span class="p">,</span> <span class="n">min_xmin</span><span class="p">,</span> <span class="n">min_xmax</span><span class="p">,</span> <span class="n">x_dim_string</span><span class="p">))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_validate_crop_coord</span><span class="p">(</span><span class="n">IFG_YLAST</span><span class="p">,</span> <span class="n">min_ymin</span><span class="p">,</span> <span class="n">min_ymax</span><span class="p">,</span> <span class="n">y_dim_string</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>


<div class="viewcode-block" id="validate_slpf_cutoff"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_slpf_cutoff">[docs]</a><span class="k">def</span> <span class="nf">validate_slpf_cutoff</span><span class="p">(</span><span class="n">extents</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> 
                               <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate SLPF_CUTOFF is within the bounds of the scene being processed</span>
<span class="sd">    (after prepifg cropping/subsampling has occurred).</span>

<span class="sd">    Args:</span>
<span class="sd">        extents : Tuple of (xmin, xmax, ymin, ymax) describing the extents</span>
<span class="sd">            of the scene, after cropping &amp; multisampling, in degrees.</span>
<span class="sd">        pars: Parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if validation is successful.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">extents</span>
    <span class="c1"># Check SLPF_CUTOFF within scene *in kilometeres*.</span>
    <span class="n">DEG_TO_KM</span> <span class="o">=</span> <span class="mf">111.32</span> <span class="c1"># km per degree</span>
    <span class="n">x_extent</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xmin</span> <span class="o">-</span> <span class="n">xmax</span><span class="p">)</span>
    <span class="n">y_extent</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">x_extent_km</span> <span class="o">=</span> <span class="n">x_extent</span> <span class="o">*</span>  <span class="n">DEG_TO_KM</span>
    <span class="n">y_extent_km</span> <span class="o">=</span> <span class="n">y_extent</span> <span class="o">*</span>  <span class="n">DEG_TO_KM</span>
    <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="n">SLPF_CUTOFF</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_extent_km</span><span class="p">,</span> <span class="n">y_extent_km</span><span class="p">):</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{SLPF_CUTOFF}</span><span class="s2">&#39;: cutoff is out of bounds, must be &quot;</span>
                  <span class="s2">&quot;less than max scene bound (in km) &quot;</span>
                  <span class="n">f</span><span class="s2">&quot;({max(x_extent_km, y_extent_km)}).&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>



<div class="viewcode-block" id="validate_multilook_parameters"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_multilook_parameters">[docs]</a><span class="k">def</span> <span class="nf">validate_multilook_parameters</span><span class="p">(</span><span class="n">cols</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">rows</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                                 <span class="n">xlks_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ylks_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                                 <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate multilook parameters by ensuring resulting resolution will be</span>
<span class="sd">    at least 1 pixel and less than the current resolution.</span>

<span class="sd">    Args:</span>
<span class="sd">        cols: Number of pixel columns (X) in the scene.</span>
<span class="sd">        rows: Number of pixel rows (Y) in the scene.</span>
<span class="sd">        xlks_name: Key for looking up the X looks factor.</span>
<span class="sd">        ylks_name: Key for looking up the Y looks factor.</span>
<span class="sd">        pars: Parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if validation is successful.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_validate_mlook</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">dim_val</span><span class="p">,</span> <span class="n">dim_str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dim_val</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{var_name}</span><span class="s2">&#39;: the multilook factor (</span><span class="si">{pars[var_name]}</span><span class="s2">) &quot;</span>
                    <span class="n">f</span><span class="s2">&quot;must be less than the number of pixels on the </span><span class="si">{dim_str}</span><span class="s2"> &quot;</span>
                    <span class="n">f</span><span class="s2">&quot;axis (</span><span class="si">{dim_val}</span><span class="s2">).&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_validate_mlook</span><span class="p">(</span><span class="n">xlks_name</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">))</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_validate_mlook</span><span class="p">(</span><span class="n">ylks_name</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_reference_pixel_search_windows"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_reference_pixel_search_windows">[docs]</a><span class="k">def</span> <span class="nf">validate_reference_pixel_search_windows</span><span class="p">(</span><span class="n">n_cols</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                            <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates that the reference pixel search windows provided by user</span>
<span class="sd">    fit within the scene being processed.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_cols: Number of pixel columns (X) in the scene.</span>
<span class="sd">        n_rows: Number of pixel rows (Y) in the scene.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the scene can accomodate the search windows (no overlap).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If the scene cannot accomodate the search windows.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">floor</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">refnx</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFNX</span><span class="p">]</span>
    <span class="n">refny</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">REFNY</span><span class="p">]</span>
    <span class="n">chip_size</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">REF_CHIP_SIZE</span><span class="p">]</span>

    <span class="n">x_windows</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">n_cols</span><span class="o">/</span><span class="n">chip_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refnx</span> <span class="o">&gt;</span> <span class="n">x_windows</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{REFNX}</span><span class="s2">&#39; &amp; &#39;</span><span class="si">{REF_CHIP_SIZE}</span><span class="s2">&#39;: search windows do not &quot;</span>
                      <span class="n">f</span><span class="s2">&quot;fit in scene on X axis (number of columns: </span><span class="si">{n_cols}</span><span class="s2">). &quot;</span>
                      <span class="n">f</span><span class="s2">&quot;Reduce </span><span class="si">{REF_CHIP_SIZE}</span><span class="s2"> or </span><span class="si">{REFNX}</span><span class="s2"> so that </span><span class="si">{REFNX}</span><span class="s2"> &quot;</span>
                      <span class="n">f</span><span class="s2">&quot;is less than or equal to (columns / </span><span class="si">{REF_CHIP_SIZE}</span><span class="s2">).&quot;</span><span class="p">)</span>
    <span class="n">y_windows</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">n_rows</span><span class="o">/</span><span class="n">chip_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">refny</span> <span class="o">&gt;</span> <span class="n">y_windows</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{REFNY}</span><span class="s2">&#39; &amp; &#39;</span><span class="si">{REF_CHIP_SIZE}</span><span class="s2">&#39;: search windows do not &quot;</span>
                      <span class="n">f</span><span class="s2">&quot;fit in scene on Y axis (number of rows: </span><span class="si">{n_rows}</span><span class="s2">). &quot;</span>
                      <span class="n">f</span><span class="s2">&quot;Reduce </span><span class="si">{REF_CHIP_SIZE}</span><span class="s2"> or </span><span class="si">{REFNY}</span><span class="s2"> so that </span><span class="si">{REFNY}</span><span class="s2"> &quot;</span>
                      <span class="n">f</span><span class="s2">&quot;is less than or equal to (rows / </span><span class="si">{REF_CHIP_SIZE}</span><span class="s2">).&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_gamma_headers"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_gamma_headers">[docs]</a><span class="k">def</span> <span class="nf">validate_gamma_headers</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slc_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">slc_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates that a pair of GAMMA headers exist for each provided</span>
<span class="sd">    GAMMA interferogram.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_file_list: Path to the file listing filenames of interferograms.</span>
<span class="sd">        slc_file_list: Path to the file listing filenames of GAMMA headers.</span>
<span class="sd">        slc_dir: Path to directory containing GAMMA headers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if there are exactly 2 headers for each interogram (one for</span>
<span class="sd">        each epoch).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If there are 0 or more than 2 matching headers</span>
<span class="sd">            for an interferogram.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyrate.core.gamma</span> <span class="k">import</span> <span class="n">get_header_paths</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">ifg</span> <span class="ow">in</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">):</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">get_header_paths</span><span class="p">(</span><span class="n">ifg</span><span class="p">,</span> <span class="n">slc_file_list</span><span class="p">,</span> <span class="n">slc_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{SLC_DIR}</span><span class="s2">&#39;: Headers not found for interferogram &quot;</span>
                          <span class="s2">&quot;&#39;</span><span class="si">{ifg}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<div class="viewcode-block" id="validate_coherence_files"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.validate_coherence_files">[docs]</a><span class="k">def</span> <span class="nf">validate_coherence_files</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validates that there is a matching coherence file for each provided</span>
<span class="sd">    interferogram.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_file_list: Path to file listing interferogram names.</span>
<span class="sd">        pars: The parameters dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if there is exactly 1 coherence file for each interferogram.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigException: If there are 0 or more than 1 matching coherence</span>
<span class="sd">            files for an interferogram.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">ifg</span> <span class="ow">in</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">):</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">coherence_paths_for</span><span class="p">(</span><span class="n">ifg</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">paths</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{COH_FILE_DIR}</span><span class="s2">&#39;: no coherence files found for &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;intergerogram &#39;</span><span class="si">{ifg}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;&#39;</span><span class="si">{COH_FILE_DIR}</span><span class="s2">&#39;: found more than one coherence &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;file for &#39;</span><span class="si">{ifg}</span><span class="s2">&#39;. There must be only one &quot;</span>
                          <span class="n">f</span><span class="s2">&quot;coherence file per interferogram. Found </span><span class="si">{paths}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_raise_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">_get_temporal_info</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the number of unique epochs and maximum time span of the </span>
<span class="sd">    dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_file_list: Path to file containing list of interferogram file names.</span>
<span class="sd">        obs_dir: Path to observations directory.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple containing the number of unique epochs and the maximum timespan.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyrate.core.algorithm</span> <span class="k">import</span> <span class="n">get_epochs</span>
    <span class="kn">from</span> <span class="nn">pyrate.core.shared</span> <span class="k">import</span> <span class="n">Ifg</span><span class="p">,</span> <span class="n">output_tiff_filename</span>

    <span class="n">ifg_paths</span> <span class="o">=</span> \
        <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obs_dir</span><span class="p">,</span> <span class="n">ifg</span><span class="p">)</span> <span class="k">for</span> <span class="n">ifg</span> <span class="ow">in</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">)]</span>
    <span class="n">rasters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ifg</span><span class="p">(</span><span class="n">output_tiff_filename</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ifg_paths</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># extents = xmin, ymin, xmax, ymax</span>
    <span class="n">epoch_list</span> <span class="o">=</span> <span class="n">get_epochs</span><span class="p">(</span><span class="n">rasters</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_epochs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_list</span><span class="o">.</span><span class="n">dates</span><span class="p">)</span>
    <span class="n">max_span</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">epoch_list</span><span class="o">.</span><span class="n">spans</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">n_epochs</span><span class="p">,</span> <span class="n">max_span</span>

<span class="k">def</span> <span class="nf">_get_prepifg_info</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrives spatial information from prepifg interferograms (images that</span>
<span class="sd">    have been cropped and multilooked).</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_file_list: Path to file containing list of interferogram file names.</span>
<span class="sd">        obs_dir: Path to observations directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyrate.core.shared</span> <span class="k">import</span> <span class="n">Ifg</span>

    <span class="n">base_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obs_dir</span><span class="p">,</span> <span class="n">ifg</span><span class="p">)</span> <span class="k">for</span> <span class="n">ifg</span> <span class="ow">in</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">)]</span>
    <span class="n">ifg_paths</span> <span class="o">=</span> <span class="n">get_dest_paths</span><span class="p">(</span><span class="n">base_paths</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">IFG_CROP_OPT</span><span class="p">],</span> <span class="n">pars</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="n">IFG_LKSX</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ifg_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ifg_paths</span><span class="p">):</span>
        <span class="n">ifg_paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifg_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_tif&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># This function assumes the stack of interferograms now have the same</span>
    <span class="c1"># bounds and resolution after going through prepifg.</span>
    <span class="n">raster</span> <span class="o">=</span> <span class="n">Ifg</span><span class="p">(</span><span class="n">ifg_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">raster</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
        <span class="n">raster</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">n_cols</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">ncols</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">nrows</span>
    <span class="n">extents</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">x_first</span><span class="p">,</span> <span class="n">raster</span><span class="o">.</span><span class="n">y_first</span><span class="p">,</span> <span class="n">raster</span><span class="o">.</span><span class="n">x_last</span><span class="p">,</span> <span class="n">raster</span><span class="o">.</span><span class="n">y_last</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>

    <span class="n">raster</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">extents</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">,</span> <span class="n">transform</span>

<span class="k">def</span> <span class="nf">_get_fullres_info</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">crop_opts</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves spatial information from the provided interferograms.</span>
<span class="sd">    Requires the interferograms to exist in geotiff format.</span>

<span class="sd">    Args:</span>
<span class="sd">        ifg_file_list: Path to file containing list of interferogram file names.</span>
<span class="sd">        obs_dir: Path to observations directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple containing extents (xmin, ymin, xmax, ymax), number of pixel</span>
<span class="sd">        columns, number of pixel rows, number of unique epochs and maximum</span>
<span class="sd">        time span of the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyrate.core.prepifg_helper</span> <span class="k">import</span> <span class="n">_min_bounds</span><span class="p">,</span> <span class="n">_get_extents</span>
    <span class="kn">from</span> <span class="nn">pyrate.core.shared</span> <span class="k">import</span> <span class="n">Ifg</span><span class="p">,</span> <span class="n">output_tiff_filename</span>

    <span class="n">ifg_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obs_dir</span><span class="p">,</span> <span class="n">ifg</span><span class="p">)</span> <span class="k">for</span> <span class="n">ifg</span> <span class="ow">in</span> <span class="n">parse_namelist</span><span class="p">(</span><span class="n">ifg_file_list</span><span class="p">)]</span>
    <span class="n">rasters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ifg</span><span class="p">(</span><span class="n">output_tiff_filename</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">obs_dir</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ifg_paths</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">is_open</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># extents = xmin, ymin, xmax, ymax</span>
    <span class="n">min_extents</span> <span class="o">=</span> <span class="n">_min_bounds</span><span class="p">(</span><span class="n">rasters</span><span class="p">)</span>
    <span class="n">post_crop_extents</span> <span class="o">=</span> <span class="n">_get_extents</span><span class="p">(</span><span class="n">rasters</span><span class="p">,</span> <span class="n">crop_opts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">user_exts</span><span class="o">=</span><span class="n">crop_opts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">x_step</span> <span class="o">=</span> <span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_step</span>
    <span class="n">y_step</span> <span class="o">=</span> <span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y_step</span>
    <span class="c1"># Get the pixel bounds. Ifg/Raster objects do have &#39;ncols&#39;/&#39;nrows&#39; </span>
    <span class="c1"># properties, but we&#39;ll calculate it off the extents we got above</span>
    <span class="c1"># because these take into account the chosen cropping option (until</span>
    <span class="c1"># the stack of interferograms is cropped it&#39;s not known what the </span>
    <span class="c1"># pixel dimensions will be).</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">post_crop_extents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">post_crop_extents</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">x_step</span><span class="p">))</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">post_crop_extents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">post_crop_extents</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">y_step</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">:</span>
        <span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">min_extents</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">n_rows</span>

<span class="k">def</span> <span class="nf">_crop_opts</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience function for getting crop options from parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyrate.core.prepifg_helper</span> <span class="k">import</span> <span class="n">CustomExts</span>

    <span class="n">crop_opt</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">IFG_CROP_OPT</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">crop_opt</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">xfirst</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">IFG_XFIRST</span><span class="p">]</span>
        <span class="n">yfirst</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">IFG_YFIRST</span><span class="p">]</span>
        <span class="n">xlast</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">IFG_XLAST</span><span class="p">]</span>
        <span class="n">ylast</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">IFG_YLAST</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">crop_opt</span><span class="p">,</span> <span class="n">CustomExts</span><span class="p">(</span><span class="n">xfirst</span><span class="p">,</span> <span class="n">yfirst</span><span class="p">,</span> <span class="n">xlast</span><span class="p">,</span> <span class="n">ylast</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">crop_opt</span><span class="p">,</span> <span class="kc">None</span>

<div class="viewcode-block" id="ConfigException"><a class="viewcode-back" href="../../../config.html#pyrate.core.config.ConfigException">[docs]</a><span class="k">class</span> <span class="nc">ConfigException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Default exception class for configuration errors.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Geoscience Australia

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<p>placeHolderText</p>
        <!-- your html code here -->
 


</body>
</html>